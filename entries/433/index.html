<html>
<head>
    <title>BLOG.IK.AM</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css" rel="stylesheet"/>
    <style>
        body {
            font-size: small;
            font-family: "Sawarabi Mincho";
            margin: 20px;
        }

        a {
            color: darkslategray;
            text-decoration: none;
        }

        article {
            border: darkgrey solid 1px;
            border-radius: 10px;
            padding: 0 10px 10px;
        }

        footer {
            margin: 10px;
        }

        blockquote {
            color: #464646;
            font-style: italic;
            border: darkgrey dotted 1px;
            border-radius: 5px;
            margin: 5px 0;
            padding: 10px;
        }

        pre {
            background-color: dimgray;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }

        h3:before {
            content: "â˜•ï¸ ";
        }

        h4:before {
            content: "ğŸƒ ";
        }

        h5:before {
            content: "âœˆï¸ï¸ ";
        }

        h6:before {
            content: "â˜ï¸ ";
        }

        pre {
            margin-bottom: 10px;
        }
    </style>
</head>
<h1>âœï¸ BLOG.IK.AM</h1>
<p><a href="https://twitter.com/making">@making</a>'s memo</p>
<body>
<article>
    <h2><a href="">Graylogã‚’BOSHã§ãƒ‡ãƒ—ãƒ­ã‚¤</a></h2>
    <p>
        Updated at <span>2017-08-07T03:25:03Z</span> by <span>Toshiaki Maki</span><br>
        Created at <span>2017-08-07T03:21:38Z</span> by <span>Toshiaki Maki</span>
    </p>
    <div><p>ãƒ­ã‚°ç®¡ç†ã®<a href="https://www.graylog.org/">Graylog</a>ã®BOSH ReleaseãŒã‚ã£ãŸã®ã§ã€è©¦ã—ã¦ã¿ãŸãƒ¡ãƒ¢ã§ã™ã€‚</p>
<p><a href="https://github.com/AusDTO/graylog-boshrelease">https://github.com/AusDTO/graylog-boshrelease</a></p>
<ul>
<li>Graylog</li>
<li>MongoDB</li>
<li>Elasticsearch (Master x 1, Data x 2)</li>
</ul>
<p>ã‚’ä¸€ç™ºã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ä¾¿åˆ©ã§ã™ã€‚</p>
<pre><code>git clone git@github.com:AusDTO/graylog-boshrelease.git
cd graylog-boshrelease
</code></pre><p>BOSH 2.0å¯¾å¿œã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€åŸºæœ¬çš„ã«ã¯</p>
<pre><code>bosh deploy -n -d graylog manifests/graylog.yml
</code></pre><p>ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚ã“ã®ã¾ã¾ã ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãŒä½¿ç”¨ã•ã‚Œã€éƒ½åˆãŒæ‚ªã„ã®ã§ã€
ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚</p>
<p>BOSH CLI v2ã‹ã‚‰ã¯<a href="">Operator files</a>ã¨ã„ã†è€ƒãˆæ–¹ãŒå°å…¥ã•ã‚Œã€
ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ›¸ãæ›ãˆãªãã¦ã‚‚ãƒ‘ãƒƒãƒç”¨ã®YAMLã‚’é©ç”¨ã™ã‚‹ã ã‘ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p>
<p>graylog-boshreleaseã§ã¯å¹¾ã¤ã‹ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆã”ã¨ã«ã™ã§ã«Operator filesãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€
ãã‚Œã‚’<code>-o</code>ã§æŒ‡å®šã—ã¦ã„ãã ã‘ã¨ãªã‚Šã¾ã™ã€‚</p>
<p>ã“ã“ã§ã¯</p>
<ul>
<li><code>network.yml</code> ... graylogã«static ipã‚’å‰²ã‚Šå½“ã¦ã‚‹ãŸã‚ã®è¨­å®š</li>
<li><code>graylog-accounts.yml</code> ... ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®š</li>
<li><code>web-endpoint-uri.yml</code> ... RESTã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®URLã®è¨­å®š(<code>/api</code>ã¾ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹)</li>
</ul>
<pre><code>bosh deploy -n -d graylog manifests/graylog.yml \
    -o manifests/operators/network.yml \
    -o manifests/operators/graylog-accounts.yml \
    -o manifests/operators/web-endpoint-uri.yml \
    -v network-name=default \
    -v graylog-static-ip=10.244.0.240 \
    -v graylog-root-email=operations@example.com \
    -v graylog-root-username=administrator \
    -v graylog-root-password-sha2=60644240fe7ef9d4b17750b226a3ba88516cea9446439d275e922377f658fc4a \
    -v graylog-web-uri=https://graylog.example.com/api
</code></pre><p>sha2ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯<code>echo -n my-big-secret | shasum -a 256</code>ã§ç”Ÿæˆã§ãã¾ã™ã€‚</p>
<p>CredHubã‚’ä½¿ã†å ´åˆã¯ã€</p>
<pre><code>credhub set -n &quot;/Bosh Lite Director/graylog/graylog-root-email&quot; --type=value -v &quot;operations@example.com&quot;
credhub set -n &quot;/Bosh Lite Director/graylog/graylog-root-username&quot; --type=value -v &quot;administrator&quot;
credhub set -n &quot;/Bosh Lite Director/graylog/graylog-root-password-sha2&quot; --type=value -v &quot;60644240fe7ef9d4b17750b226a3ba88516cea9446439d275e922377f658fc4a&quot;
</code></pre><p>ã§è¨­å®šã—ã€</p>
<pre><code>bosh deploy -n -d graylog manifests/graylog.yml \
    -o manifests/operators/network.yml \
    -o manifests/operators/graylog-accounts.yml \
    -o manifests/operators/web-endpoint-uri.yml \
    -v network-name=default \
    -v graylog-static-ip=10.244.0.240 \
    -v graylog-web-uri=https://graylog.example.com/api
</code></pre><p>ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚</p>
<pre><code>$ bosh vms -d graylog
Using environment &#39;192.168.50.6&#39; as client &#39;admin&#39;

Task 131122. Done

Deployment &#39;graylog&#39;

Instance                                                   Process State  AZ  IPs           VM CID                                VM Type  
elasticsearch-data/244afec8-3a5c-4e83-950a-28d1be187595    running        z1  10.244.0.10   304db4a0-50da-4230-5122-e9224c07f3cf  default  
elasticsearch-data/bbb21ffe-3cb9-43c3-b4ab-778aeb9a58f3    running        z1  10.244.0.9    caf7fd07-a0ff-49e0-6fb8-6b61d6b8e90c  default  
elasticsearch-master/0f2c212d-fbaf-448d-bfa8-b33102b41777  running        z1  10.244.0.8    e1e6aa3a-0fd2-451d-58ab-7042f240a6b0  default  
graylog/506d8334-dd3b-48d8-8429-4558cf088f4e               running        z1  10.244.0.240  c8b6ecef-073c-4156-6925-89562effd3ab  default  
mongodb/4182fb43-c8b4-422b-9356-7b82935713c6               running        z1  10.244.0.7    2710fa09-7333-430c-5545-bec0a8a0e21e  default  

5 vms

Succeeded
</code></pre><p>ç°¡å˜ã§ã™ã€‚</p>
<p><img width="80%" src="https://user-images.githubusercontent.com/106908/29011041-cab6e9b6-7b6a-11e7-8c3a-091109b71f66.png"></p>
<p><img width="80%" src="https://user-images.githubusercontent.com/106908/29011042-ccd6ce28-7b6a-11e7-9d16-cdddf326156f.png"></p>
<p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‘ã©ã€Graylogã®ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„...</p>
</div>
</article>
<footer>
    <a href="https://blog.ik.am">BLOG.IK.AM</a> â€” &copy; 2010-2017 <a href="https://twitter.com/making">Toshiaki
    Maki</a>
</footer>
</body>
</html>