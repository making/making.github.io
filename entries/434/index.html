<html>
<head>
    <title>BLOG.IK.AM</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css" rel="stylesheet"/>
    <style>
        body {
            font-size: small;
            font-family: "Sawarabi Mincho";
            margin: 20px;
        }

        a {
            color: darkslategray;
            text-decoration: none;
        }

        article {
            border: darkgrey solid 1px;
            border-radius: 10px;
            padding: 0 10px 10px;
        }

        footer {
            margin: 10px;
        }

        blockquote {
            color: #464646;
            font-style: italic;
            border: darkgrey dotted 1px;
            border-radius: 5px;
            margin: 5px 0;
            padding: 10px;
        }

        pre {
            background-color: dimgray;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }

        h3:before {
            content: "â˜•ï¸ ";
        }

        h4:before {
            content: "ğŸƒ ";
        }

        h5:before {
            content: "âœˆï¸ï¸ ";
        }

        h6:before {
            content: "â˜ï¸ ";
        }

        pre {
            margin-bottom: 10px;
        }
    </style>
</head>
<h1>âœï¸ BLOG.IK.AM</h1>
<p><a href="https://twitter.com/making">@making</a>'s memo</p>
<body>
<article>
    <h2><a href="">Cloud Foundryã®buildpackã‚’ä½¿ã£ã¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤</a></h2>
    <p>
        Updated at <span>2017-08-21T05:53:23Z</span> by <span>Toshiaki Maki</span><br>
        Created at <span>2017-08-21T05:32:40Z</span> by <span>Toshiaki Maki</span>
    </p>
    <div><p><strong>ç›®æ¬¡</strong></p>
<!-- toc -->
<ul>
<li><a href="#buildpack-dockerfile">Buildpackã¨Dockerfile</a></li>
<li><a href="#cf-local-plugin">CF Local Plugin</a></li>
<li><a href="#cf-local-">CF Localã®åˆ©ç”¨</a><ul>
<li><a href="#cloud-foundry-cli-">Cloud Foundry CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li>
<li><a href="#cf-local-plugin-">CF Local Pluginã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li>
<li><a href="#-">ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ</a></li>
<li><a href="#docker-export">Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¸Export</a></li>
<li><a href="#k8s-">k8sã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</a></li>
<li><a href="#buildpack-">Buildpackã®æ›´æ–°</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h3 id="buildpack-dockerfile">Buildpackã¨Dockerfile</h3>
<p>Cloud Foundryã®<a href="https://docs.cloudfoundry.org/buildpacks/">buildpack</a>ã¯ä¾¿åˆ©ã§ã€&quot;Source Code to Container Image&quot;ã‚’å®Ÿç¾ã—ã¦ãã‚Œã¾ã™ã€‚</p>
<p>Dockerã‚’ç”¨ã„ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯ã€ä¸€èˆ¬çš„ã«</p>
<ol>
<li>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä½œæˆ/ä¿®æ­£</li>
<li><code>Dockerfile</code>ä½œæˆ/ä¿®æ­£</li>
<li>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ</li>
<li>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</li>
<li>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ã‚³ãƒ³ãƒ†ãƒŠ)ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</li>
</ol>
<p>ã§ã™ãŒã€Cloud Foundryã§ã¯buildpackã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã‚Š</p>
<ol>
<li>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä½œæˆ/ä¿®æ­£</li>
<li><code>cf push</code>ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ã‚³ãƒ³ãƒ†ãƒŠ)ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</li>
</ol>
<p>ã§å®Œäº†ã—ã¾ã™ã€‚</p>
<p>Dockerã®å ´åˆã€é€šå¸¸<code>Dockerfile</code>ã‚’ä½œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ã“ã‚Œã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ä»–ã«</p>
<ul>
<li>OSã‚¤ãƒ¡ãƒ¼ã‚¸(opensshã®è„†å¼±æ€§å¯¾å¿œãªã©)</li>
<li>ãƒ©ãƒ³ã‚¿ã‚¤ãƒ /ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢(Javaã®å ´åˆJDKã‚„Tomcatã€PHPã®å ´åˆApache HTTPã‚„mod_phpãªã©)</li>
</ul>
<p>ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚‚ã—ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚<code>Dockerfile</code>ã¯è‡ªç”±åº¦ãŒé«˜ã„åé¢ã€ã‚±ã‚¢ã™ã¹ãç‚¹ã‚‚å¤šã„ã§ã™ã€‚</p>
<p>ä¸€æ–¹ã€buildpackã§ã¯rootfsã¨ã—ã¦<a href="https://github.com/cloudfoundry/cflinuxfs2">cflinuxfs2</a>ã¨ã„ã†Ubuntu14.04ã®æ´¾ç”Ÿã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚å®šæœŸçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒãŒã‚ã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
ã¾ãŸå„è¨€èªã”ã¨ã«ãƒ©ãƒ³ã‚¿ã‚¤ãƒ /ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ãŠã‚Šã€åŸå‰‡ã¨ã—ã¦CVEï¼ˆCommon Vulnerabilities and Exposuresï¼‰å…¬é–‹å¾Œ48æ™‚é–“ä»¥å†…ã«ãƒ‘ãƒƒãƒãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€åŸºæœ¬çš„ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã®ã¿é›†ä¸­ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p>å€‹äººçš„ã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ã®è¦³ç‚¹ã§ã¯<code>Dockerfile</code>ã®ä½œæˆã¯ã‚ã¾ã‚Šã‚„ã‚ŠãŸã„ä½œæ¥­ã§ã‚ã‚Šã¾ã›ã‚“ã€‚Buildpackæ–¹å¼ã®ã»ã†ãŒå¥½ã¿ã§ã™ã€‚</p>
<h3 id="cf-local-plugin">CF Local Plugin</h3>
<p><a href="https://github.com/sclevine/cflocal">CF Local Plugin</a>ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å‰è¿°ã®buildpackã«ã‚ˆã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚’Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã«ã‚‚é©ç”¨ã§ãã¾ã™ã€‚
CF Localã¯Laptopå†…ã§<code>cf push</code>ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ãŒã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¸ã®Exportã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>
<p>ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã‚Šã€Dockerã‚’ç”¨ã„ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã‚‚ã€</p>
<ol>
<li>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä½œæˆ/ä¿®æ­£</li>
<li>CF Localã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ</li>
<li>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</li>
<li>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ã‚³ãƒ³ãƒ†ãƒŠ)ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</li>
</ol>
<p>ã«ãªã‚Šã€<code>Dockerfile</code>ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‹ã‚‰è§£æ”¾ã•ã‚Œã¾ã™ã€‚</p>
<p>ã“ã‚Œã§Buildpackã®ãƒ¡ãƒªãƒƒãƒˆã‚’æ´»ã‹ã—ã¤ã¤ã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
<h3 id="cf-local-">CF Localã®åˆ©ç”¨</h3>
<p>ã§ã¯å®Ÿéš›ã«CF Localã§&quot;Source Code to Docker Image&quot;ã‚’è¡Œã„ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’k8sã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚</p>
<h4 id="cloud-foundry-cli-">Cloud Foundry CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4>
<p>ã¾ãšã¯<code>cf</code>ã‚³ãƒãƒ³ãƒ‰ãŒå¿…è¦ã§ã™ã€‚golangã®å®Ÿè¡Œå¯èƒ½ãƒã‚¤ãƒŠãƒªãªã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å®¹æ˜“ã§ã™ã€‚</p>
<p>CF CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯<a href="https://github.com/cloudfoundry/cli/releases">ã“ã¡ã‚‰</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
<p>Macã®å ´åˆã¯ã€</p>
<pre><code>brew install cloudfoundry/tap/cf-cli
</code></pre><p>ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚</p>
<h4 id="cf-local-plugin-">CF Local Pluginã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4>
<p>CF Local Pluginã®ãƒã‚¤ãƒŠãƒªã¯<a href="https://github.com/sclevine/cflocal/releases">ã“ã¡ã‚‰</a>ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚</p>
<p>Macã®å ´åˆã¯ã€</p>
<pre><code>curl -L -J -O https://github.com/sclevine/cflocal/releases/download/v0.13.0/cflocal-0.13.0-macos
cf install-plugin cflocal-0.13.0-macos
</code></pre><p>ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚</p>
<h4 id="-">ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ</h4>
<p>ä»Šå›ã¯æ¬¡ã®ç°¡å˜ãªJavaã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³(ãŸã ã®ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆ)ã‚’é¡Œæã«ä½¿ç”¨ã—ã¾ã™ã€‚
<a href="https://github.com/making/hello-servlet">https://github.com/making/hello-servlet</a></p>
<pre><code>git clone git@github.com:making/hello-servlet.git
cd hello-servlet
./mvnw package
</code></pre><p>ã§<code>target/ROOT.war</code>ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚</p>
<p>ãã®å¾Œã€<code>cf local stage</code>ã‚³ãƒãƒ³ãƒ‰ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚’è¡Œã„ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸(Droplet)ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre><code>cf local stage hello-servlet -p ./target/ROOT.war
</code></pre><p>æ¬¡ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚JDKã‚„TomcatãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¾ãŸã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚º(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1GB)ã«åˆã‚ã›ã¦ã€JVMã®ãƒ¡ãƒ¢ãƒªã®è¨­å®šãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã™ã€‚ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºã¯<code>-m</code>ã§å¤‰æ›´å¯èƒ½ã§ã™ã€‚</p>
<pre><code>Buildpack: will detect                                                         
[hello-servlet] 2017-08-21T04:32:48.695440393Z -----&gt; Java Buildpack Version: v3.17 | https://github.com/cloudfoundry/java-buildpack.git#87fb619
[hello-servlet] 2017-08-21T04:32:51.033834076Z -----&gt; Downloading Open Jdk JRE 1.8.0_141 from https://java-buildpack.cloudfoundry.org/openjdk/trusty/x86_64/openjdk-1.8.0_141.tar.gz (2.1s)
[hello-servlet] 2017-08-21T04:32:51.977072148Z        Expanding Open Jdk JRE to .java-buildpack/open_jdk_jre (0.9s)
[hello-servlet] 2017-08-21T04:32:52.094011807Z -----&gt; Downloading Open JDK Like Memory Calculator 2.0.2_RELEASE from https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-2.0.2_RELEASE.tar.gz (0.1s)
[hello-servlet] 2017-08-21T04:32:52.117972916Z        Memory Settings: -Xss349K -Xmx681574K -XX:MaxMetaspaceSize=104857K -Xms681574K -XX:MetaspaceSize=104857K
[hello-servlet] 2017-08-21T04:32:52.223085215Z -----&gt; Downloading Container Security Provider 1.8.0_RELEASE from https://java-buildpack.cloudfoundry.org/container-security-provider/container-security-provider-1.8.0_RELEASE.jar (0.1s)
[hello-servlet] 2017-08-21T04:32:53.174939975Z -----&gt; Downloading Tomcat Instance 8.0.46 from https://java-buildpack.cloudfoundry.org/tomcat/tomcat-8.0.46.tar.gz (0.9s)
[hello-servlet] 2017-08-21T04:32:53.278926558Z        Expanding Tomcat Instance to .java-buildpack/tomcat (0.1s)
[hello-servlet] 2017-08-21T04:32:53.436115761Z -----&gt; Downloading Tomcat Lifecycle Support 2.5.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-lifecycle-support/tomcat-lifecycle-support-2.5.0_RELEASE.jar (0.1s)
[hello-servlet] 2017-08-21T04:32:53.668302543Z -----&gt; Downloading Tomcat Logging Support 2.5.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-logging-support/tomcat-logging-support-2.5.0_RELEASE.jar (0.2s)
[hello-servlet] 2017-08-21T04:32:53.747964428Z -----&gt; Downloading Tomcat Access Logging Support 2.5.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-access-logging-support/tomcat-access-logging-support-2.5.0_RELEASE.jar (0.0s)
Successfully staged: hello-servlet
</code></pre><p>Gifã‚¢ãƒ‹ãƒ¡ã‚‚è²¼ã£ã¦ãŠãã¾ã™ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/106908/29503885-8d602192-8676-11e7-9a10-3b730cfaf689.gif" alt="cflocal"></p>
<blockquote>
<p>Javaä»¥å¤–ã®å ´åˆã€<code>-p</code>ã¯ä¸è¦ã§ã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p>
</blockquote>
<p>ä½œæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¯<code>cf local run</code>ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚</p>
<pre><code>$ cf local run hello-servlet
Running hello-servlet on port 54921...                                         
[hello-servlet] 2017-08-21T04:51:20.509802947Z [CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Initializing ProtocolHandler [&quot;http-nio-8080&quot;]
[hello-servlet] 2017-08-21T04:51:20.517556491Z [CONTAINER] org.apache.catalina.startup.Catalina               INFO    Initialization processed in 371 ms
[hello-servlet] 2017-08-21T04:51:20.524758060Z [CONTAINER] org.apache.catalina.core.StandardService           INFO    Starting service Catalina
[hello-servlet] 2017-08-21T04:51:20.525311765Z [CONTAINER] org.apache.catalina.core.StandardEngine            INFO    Starting Servlet Engine: Apache Tomcat/8.0.46
[hello-servlet] 2017-08-21T04:51:20.539589930Z [CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deploying web application directory /home/vcap/app/.java-buildpack/tomcat/webapps/ROOT
[hello-servlet] 2017-08-21T04:51:20.815559712Z [CONTAINER] org.apache.jasper.servlet.TldScanner               INFO    At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.
[hello-servlet] 2017-08-21T04:51:20.869397279Z [CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deployment of web application directory /home/vcap/app/.java-buildpack/tomcat/webapps/ROOT has finished in 329 ms
[hello-servlet] 2017-08-21T04:51:20.874792454Z [CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Starting ProtocolHandler [&quot;http-nio-8080&quot;]
[hello-servlet] 2017-08-21T04:51:20.880862674Z [CONTAINER] org.apache.tomcat.util.net.NioSelectorPool         INFO    Using a shared selector for servlet write/read
[hello-servlet] 2017-08-21T04:51:20.889905003Z [CONTAINER] org.apache.catalina.startup.Catalina               INFO    Server startup in 371 ms
</code></pre><p>ã“ã®ä¾‹ã§ã¯localhostã®54921ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®8080ãƒãƒ¼ãƒˆã«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚</p>
<pre><code>$ curl localhost:54921

â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘    â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•    â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•    â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•  â•šâ•â•   â•šâ•â•        â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•
</code></pre><h4 id="docker-export">Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¸Export</h4>
<p>ã“ã“ã¾ã§ã§Cloud Foundryã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚ã‚‹Dropletãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚’<code>cf local export</code>ã‚³ãƒãƒ³ãƒ‰ã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>
<pre><code>cf local export hello-servlet -r making/hello-servlet
</code></pre><p><code>making/hello-servlet</code>ã¨ã„ã†åå‰ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œæˆã§ãã¾ã—ãŸã€‚</p>
<pre><code>$ docker images
REPOSITORY                TAG                 IMAGE ID            CREATED              SIZE
making/hello-servlet      latest              61d311f1bd06        3 seconds ago        951MB
&lt;none&gt;                    &lt;none&gt;              74a5658980c7        About a minute ago   951MB
cflocal                   latest              79e3268df4cf        5 minutes ago        953MB
cloudfoundry/cflinuxfs2   latest              a7adacf72d2a        3 days ago           893MB
</code></pre><p>ã‚‚ã¡ã‚ã‚“ã€ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯<code>docker run</code>ã§å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚</p>
<pre><code>$ docker run -p 8080:8080 making/hello-servlet
[CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Initializing ProtocolHandler [&quot;http-nio-8080&quot;]
[CONTAINER] org.apache.catalina.startup.Catalina               INFO    Initialization processed in 416 ms
[CONTAINER] org.apache.catalina.core.StandardService           INFO    Starting service Catalina
[CONTAINER] org.apache.catalina.core.StandardEngine            INFO    Starting Servlet Engine: Apache Tomcat/8.0.46
[CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deploying web application directory /home/vcap/app/.java-buildpack/tomcat/webapps/ROOT
[CONTAINER] org.apache.jasper.servlet.TldScanner               INFO    At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.
[CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deployment of web application directory /home/vcap/app/.java-buildpack/tomcat/webapps/ROOT has finished in 410 ms
[CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Starting ProtocolHandler [&quot;http-nio-8080&quot;]
[CONTAINER] org.apache.tomcat.util.net.NioSelectorPool         INFO    Using a shared selector for servlet write/read
[CONTAINER] org.apache.catalina.startup.Catalina               INFO    Server startup in 458 ms
</code></pre><pre><code>$ curl localhost:8080

â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘    â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•    â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•    â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•  â•šâ•â•   â•šâ•â•        â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•
</code></pre><p>ãã—ã¦ã€<code>docker push</code>ã§Docker Registryã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p>
<pre><code>docker push making/hello-servlet
</code></pre><h4 id="k8s-">k8sã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h4>
<p>Docker Registryã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå¾Œã¯ã€æ™®é€šã«k8sã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚</p>
<pre><code>$ kubectl run hello-servlet --image=making/hello-servlet --port=8080
deployment &quot;hello-servlet&quot; created

$ kubectl expose deployment hello-servlet --type=NodePort
service &quot;hello-servlet&quot; exposed

$ kubectl get service hello-servlet -o wide
NAME            CLUSTER-IP   EXTERNAL-IP   PORT(S)          AGE       SELECTOR
hello-servlet   10.0.0.61    &lt;nodes&gt;       8080:32271/TCP   20s       run=hello-servlet

$ curl `minikube ip`:32271

â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘    â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•    â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•    â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•  â•šâ•â•   â•šâ•â•        â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•
</code></pre><h4 id="buildpack-">Buildpackã®æ›´æ–°</h4>
<p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Buildpackã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯CF Local Pluginã«ä¾å­˜ã™ã‚‹ãŸã‚ã€Buildpackã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã—ãŸã„å ´åˆã¯ã€<code>-b</code>ã§æ˜ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Java Buildpackã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã€åŸ·ç­†æ™‚ç‚¹ã§æœ€æ–°ã®<a href="https://github.com/cloudfoundry/java-buildpack/releases/tag/v4.5">4.5</a>ã«ã‚ã’ã¦ã¿ã¾ã™ã€‚</p>
<pre><code>$ cf local stage hello-servlet -p ./target/ROOT.war -b https://github.com/cloudfoundry/java-buildpack.git#v4.5
Buildpack: https://github.com/cloudfoundry/java-buildpack.git#v4.5             
[hello-servlet] 2017-08-21T05:23:44.725841336Z -----&gt; Java Buildpack v4.5 | https://github.com/cloudfoundry/java-buildpack.git#36205c5
[hello-servlet] 2017-08-21T05:23:45.153024223Z -----&gt; Downloading Jvmkill Agent 1.10.0_RELEASE from https://java-buildpack.cloudfoundry.org/jvmkill/trusty/x86_64/jvmkill-1.10.0_RELEASE.so (0.2s)
[hello-servlet] 2017-08-21T05:23:45.201490613Z -----&gt; Downloading Open Jdk JRE 1.8.0_141 from https://java-buildpack.cloudfoundry.org/openjdk/trusty/x86_64/openjdk-1.8.0_141.tar.gz (found in cache)
[hello-servlet] 2017-08-21T05:23:46.099868077Z        Expanding Open Jdk JRE to .java-buildpack/open_jdk_jre (0.8s)
[hello-servlet] 2017-08-21T05:23:46.937437172Z -----&gt; Downloading Open JDK Like Memory Calculator 3.9.0_RELEASE from https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-3.9.0_RELEASE.tar.gz (0.8s)
[hello-servlet] 2017-08-21T05:23:47.235578582Z        Loaded Classes: 9742, Threads: 300
[hello-servlet] 2017-08-21T05:23:47.359764715Z -----&gt; Downloading Client Certificate Mapper 1.2.0_RELEASE from https://java-buildpack.cloudfoundry.org/client-certificate-mapper/client-certificate-mapper-1.2.0_RELEASE.jar (0.1s)
[hello-servlet] 2017-08-21T05:23:47.416043793Z -----&gt; Downloading Container Security Provider 1.8.0_RELEASE from https://java-buildpack.cloudfoundry.org/container-security-provider/container-security-provider-1.8.0_RELEASE.jar (found in cache)
[hello-servlet] 2017-08-21T05:23:48.042413872Z -----&gt; Downloading Tomcat Instance 8.5.20 from https://java-buildpack.cloudfoundry.org/tomcat/tomcat-8.5.20.tar.gz (0.6s)
[hello-servlet] 2017-08-21T05:23:48.153498196Z        Expanding Tomcat Instance to .java-buildpack/tomcat (0.1s)
[hello-servlet] 2017-08-21T05:23:48.211211569Z -----&gt; Downloading Tomcat Access Logging Support 3.0.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-access-logging-support/tomcat-access-logging-support-3.0.0_RELEASE.jar (found in cache)
[hello-servlet] 2017-08-21T05:23:48.253126051Z -----&gt; Downloading Tomcat Lifecycle Support 3.0.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-lifecycle-support/tomcat-lifecycle-support-3.0.0_RELEASE.jar (found in cache)
[hello-servlet] 2017-08-21T05:23:48.300813949Z -----&gt; Downloading Tomcat Logging Support 3.0.0_RELEASE from https://java-buildpack.cloudfoundry.org/tomcat-logging-support/tomcat-logging-support-3.0.0_RELEASE.jar (found in cache)
Successfully staged: hello-servlet
</code></pre><p>ã“ã‚Œã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ›´æ–°ã•ã‚Œã€TomcatãŒ8.5ç³»ã«ä¸ŠãŒã‚Šã¾ã—ãŸã€‚ã¾ãŸã€JVMã®Memory Calculatorã®ä»•æ§˜ã‚‚<a href="https://www.cloudfoundry.org/just-released-java-buildpack-4-0/">å¤‰ã‚ã‚Šã¾ã—ãŸ</a>ã€‚
ãƒ¡ãƒ¢ãƒªè¨­å®šã‚’Buildpackã«ãŠä»»ã›ã§ãã¦æ¥½ã§ã™ã€‚k8sã«Javaã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã‚‚ã€Buildpackã®æ©æµã«ä¸ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<pre><code>$ cf local run hello-servlet
Running hello-servlet on port 55383...                                         
[hello-servlet] 2017-08-21T05:25:36.151338888Z JVM Memory Configuration: -XX:CompressedClassSpaceSize=15326K -Xss1M -Xmx394118K -XX:MaxDirectMemorySize=10M -XX:MaxMetaspaceSize=75931K -XX:ReservedCodeCacheSize=240M
[hello-servlet] 2017-08-21T05:25:36.663399060Z [CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Initializing ProtocolHandler [&quot;http-nio-8080&quot;]
[hello-servlet] 2017-08-21T05:25:36.674031978Z [CONTAINER] org.apache.catalina.startup.Catalina               INFO    Initialization processed in 373 ms
[hello-servlet] 2017-08-21T05:25:36.681052927Z [CONTAINER] org.apache.catalina.core.StandardService           INFO    Starting service [Catalina]
[hello-servlet] 2017-08-21T05:25:36.681435114Z [CONTAINER] org.apache.catalina.core.StandardEngine            INFO    Starting Servlet Engine: Apache Tomcat/8.5.20
[hello-servlet] 2017-08-21T05:25:36.709458734Z [CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deploying web application directory [/home/vcap/app/.java-buildpack/tomcat/webapps/ROOT]
[hello-servlet] 2017-08-21T05:25:37.030274533Z [CONTAINER] org.apache.jasper.servlet.TldScanner               INFO    At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.
[hello-servlet] 2017-08-21T05:25:37.097099849Z [CONTAINER] org.apache.catalina.startup.HostConfig             INFO    Deployment of web application directory [/home/vcap/app/.java-buildpack/tomcat/webapps/ROOT] has finished in [387] ms
[hello-servlet] 2017-08-21T05:25:37.101279358Z [CONTAINER] org.apache.coyote.http11.Http11NioProtocol         INFO    Starting ProtocolHandler [&quot;http-nio-8080&quot;]
[hello-servlet] 2017-08-21T05:25:37.110166410Z [CONTAINER] org.apache.tomcat.util.net.NioSelectorPool         INFO    Using a shared selector for servlet write/read
[hello-servlet] 2017-08-21T05:25:37.126321558Z [CONTAINER] org.apache.catalina.startup.Catalina               INFO    Server startup in 451 ms
</code></pre><hr>
<p>CF Local Pluginã¯ã‚‚ã¨ã‚‚ã¨ã¯Cloud Foundryã‚’ä½¿ã£ãŸé–‹ç™ºã«ãŠã„ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å††æ»‘ã«è¡Œã†ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ãŒã€
ã“ã‚Œã‚’ä½¿ã£ã¦ã€<code>Dockerfile</code>ã‚’ä½œã‚‹ã“ã¨ãªãBuildpackã‹ã‚‰Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã€k8sã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚</p>
<p>CF Local Pluginã¯ã¾ã ã€<a href="https://github.com/sclevine">Stephen Levine</a>ã•ã‚“ã®å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰±ã„ã§ã™ãŒã€Cloud Foundry Summit 2017ã®Keynoteã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã®ã§ã€
Cloud Foundryå…¬å¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚</p>
</div>
</article>
<footer>
    <a href="https://blog.ik.am">BLOG.IK.AM</a> â€” &copy; 2010-2017 <a href="https://twitter.com/making">Toshiaki
    Maki</a>
</footer>
</body>
</html>