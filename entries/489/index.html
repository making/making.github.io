<html>
<head>
    <title>BLOG.IK.AM</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css" rel="stylesheet"/>
    <style>
        body {
            font-size: small;
            font-family: "Sawarabi Mincho";
            margin: 20px;
        }

        a {
            color: darkslategray;
            text-decoration: none;
        }

        article {
            border: darkgrey solid 1px;
            border-radius: 10px;
            padding: 0 10px 10px;
        }

        footer {
            margin: 10px;
        }

        blockquote {
            color: #464646;
            font-style: italic;
            border: darkgrey dotted 1px;
            border-radius: 5px;
            margin: 5px 0;
            padding: 10px;
        }

        pre {
            background-color: dimgray;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }

        h3:before {
            content: "â˜•ï¸ ";
        }

        h4:before {
            content: "ğŸƒ ";
        }

        h5:before {
            content: "âœˆï¸ï¸ ";
        }

        h6:before {
            content: "â˜ï¸ ";
        }

        pre {
            margin-bottom: 10px;
        }
    </style>
</head>
<h1>âœï¸ BLOG.IK.AM</h1>
<p><a href="https://twitter.com/making">@making</a>'s memo</p>
<body>
<article>
    <h2><a href="">Reactor Testã§é›ãˆã‚‹Reactorè„³ãƒˆãƒ¬</a></h2>
    <p>
        Updated at <span>2017-10-11T09:24:40Z</span> by <span>Toshiaki Maki</span><br>
        Created at <span>2017-10-10T17:31:19Z</span> by <span>Toshiaki Maki</span>
    </p>
    <div><p>Reactorã«ã¯ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼<code>StepVerifier</code>ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<p><a href="http://projectreactor.io/docs/core/release/reference/#testing">http://projectreactor.io/docs/core/release/reference/#testing</a></p>
<p>ã“ã®<code>StepVerifier</code>ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆä¸­ã«ã€<code>Flux</code>/<code>Mono</code>ã‚’<code>subscribe</code>ã—ãŸã‚Š<code>block</code>ã—ãŸã‚Šã—ãªãã¦ã‚‚ã€
ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹ã‚’æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<h3 id="-">ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ </h3>
<p><code>reactor-test</code>ã‚’è¿½åŠ ã™ã‚Œã°åˆ©ç”¨å¯èƒ½ã§ã™ã€‚</p>
<pre><code class="lang-xml">        &lt;dependency&gt;
            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="-">ä½¿ã„æ–¹</h3>
<p><code>StepVerifier.create</code>ã«<code>Publisher</code>ã«æ¸¡ã—ã¦ã€<code>expectXxxx</code>ãƒ¡ã‚½ãƒƒãƒ‰ã§æ¤œè¨¼ã§ã™ã€‚</p>
<p>ä»¥ä¸‹ã¯ä½¿ç”¨ä¾‹ã§ã™ã€‚</p>
<pre><code class="lang-java">import org.junit.Test;
import reactor.core.publisher.Flux;
import reactor.test.StepVerifier;

public class ReactorDojoTest {
    ReactorDojo reactorDojo = new ReactorDojo();

    @Test
    public void identity() throws Exception {
        Flux&lt;String&gt; input = Flux.just(&quot;hoge&quot;, &quot;foo&quot;, &quot;bar&quot;);
        Flux&lt;String&gt; output = reactorDojo.identity(input);

        StepVerifier
                .create(output)
                .expectNext(&quot;hoge&quot;, &quot;foo&quot;, &quot;bar&quot;)
                .verifyComplete();
    }

    @Test
    public void toUppercase() throws Exception {
        Flux&lt;String&gt; input = Flux.just(&quot;hoge&quot;, &quot;foo&quot;, &quot;bar&quot;);
        Flux&lt;String&gt; output = reactorDojo.toUppercase(input);

        StepVerifier
                .create(output)
                .expectNext(&quot;HOGE&quot;, &quot;FOO&quot;, &quot;BAR&quot;)
                .verifyComplete();
    }

    @Test
    public void toOddNumbers() throws Exception {
        Flux&lt;Integer&gt; input = Flux.just(1, 2, 3, 4, 5, 6, 7, 8, 9);
        Flux&lt;Integer&gt; output = reactorDojo.oddNumbers(input);

        StepVerifier
                .create(output)
                .expectNext(1, 3, 5, 7, 9)
                .verifyComplete();
    }

    @Test
    public void commaSplit() throws Exception {
        Flux&lt;String&gt; input = Flux.just(&quot;aaa,bbb,&quot;, &quot;ccc,ddddd,eee,&quot;, &quot;ffff,g,&quot;, &quot;hh,&quot;, &quot;iiiii,jjj,&quot;);
        Flux&lt;String&gt; output = reactorDojo.commaSplit(input);

        StepVerifier
                .create(output)
                .expectNext(&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;, &quot;ddddd&quot;, &quot;eee&quot;, &quot;ffff&quot;, &quot;g&quot;, &quot;hh&quot;, &quot;iiiii&quot;, &quot;jjj&quot;)
                .verifyComplete();
    }
}
</code></pre>
<h3 id="reactor-">Reactorè„³ãƒˆãƒ¬</h3>
<p>ã§ã¯ä¸Šè¨˜ã®ãƒ†ã‚¹ãƒˆã‚’ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨ã—ã¦ã€<code>input</code>ã‚’å—ã‘å–ã£ã¦<code>output</code>ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
<p>æ¬¡ã®é››å½¢ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
<pre><code class="lang-java">import reactor.core.publisher.Flux;

import java.util.stream.Collectors;

public class ReactorDojo {

    public Flux&lt;String&gt; identity(Flux&lt;String&gt; input) {
        return input;
    }

    public Flux&lt;String&gt; toUppercase(Flux&lt;String&gt; input) {
        return input;
    }

    public Flux&lt;Integer&gt; oddNumbers(Flux&lt;Integer&gt; input) {
        return input;
    }

    public Flux&lt;String&gt; commaSplit(Flux&lt;String&gt; input) {
        return input;
    }
}
</code></pre>
<p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚ç”¨æ„ã—ã¾ã—ãŸã®ã§ã€å®Ÿè£…ã—ãŸã„æ–¹ã¯åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
<p><a href="https://github.com/making/reactor-dojo">https://github.com/making/reactor-dojo</a></p>
<p>ã“ã®ã¾ã¾ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨3ä»¶ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/106908/31400320-1cd4fdc2-ae2a-11e7-907c-f2773771fd16.png" alt="image"></p>
<p>å…¨ã¦ç·‘ã«ãªã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ç°¡å˜ã§ã™ã­ï¼Ÿ</p>
<h3 id="-reactor-">çœŸã®Reactorè„³ãƒˆãƒ¬</h3>
<p>ä¸Šè¨˜ã®ä¾‹ã¯ã¨ã¦ã‚‚ç°¡å˜ã§Java 8ã®Stream APIã®åˆ©ç”¨çµŒé¨“ãŒã‚ã‚Œã°ã€å®Ÿè£…ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
ã§ã¯é€šå¸¸ã®Stream APIã§ã¯å®Ÿç¾ã§ããªã„ä¾‹ã‚’æŒ™ã’ã¾ã™ã€‚</p>
<p>ä¸Šè¨˜ã®<code>commaSplit</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚‚è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ãƒ†ã‚¹ãƒˆã‚‚é€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
<pre><code class="lang-java">    @Test
    public void commaSplitAdvanced() throws Exception {
        Flux&lt;String&gt; input = Flux.just(&quot;aaa,bb&quot;, &quot;b,ccc,ddddd,e&quot;, &quot;ee,ff&quot;, &quot;ff,g,hh,i&quot;, &quot;i&quot;, &quot;iii,jjj,&quot;);
        Flux&lt;String&gt; output = reactorDojo.commaSplit(input);

        StepVerifier
                .create(output)
                .expectNext(&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;, &quot;ddddd&quot;, &quot;eee&quot;, &quot;ffff&quot;, &quot;g&quot;, &quot;hh&quot;, &quot;iiiii&quot;, &quot;jjj&quot;)
                .verifyComplete();
    }
</code></pre>
<p>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯æœ‰é™ãªã‚¹ãƒˆãƒªãƒ¼ãƒ ã§ã™ãŒã€å®Ÿéš›ã¯ãƒ‡ãƒ¼ã‚¿ãŒç¶šãã“ã¨æƒ³å®šã—ã¦å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§ã‚‚æˆåŠŸã—ã¾ã™ã‹ï¼Ÿ</p>
<pre><code class="lang-java">    @Test
    public void commaSplitAdvancedInfinite() throws Exception {
        Flux&lt;String&gt; input = Flux.just(&quot;aaa,bb&quot;, &quot;b,ccc,ddddd,e&quot;, &quot;ee,ff&quot;, &quot;ff,g,hh,i&quot;, &quot;i&quot;, &quot;iii,jjj,&quot;).repeat();
        Flux&lt;String&gt; output = reactorDojo.commaSplit(input);

        StepVerifier
                .create(output)
                .expectNext(&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;, &quot;ddddd&quot;, &quot;eee&quot;, &quot;ffff&quot;, &quot;g&quot;, &quot;hh&quot;, &quot;iiiii&quot;, &quot;jjj&quot;)
                .expectNext(&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;, &quot;ddddd&quot;, &quot;eee&quot;, &quot;ffff&quot;, &quot;g&quot;, &quot;hh&quot;, &quot;iiiii&quot;, &quot;jjj&quot;)
                .expectNext(&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;, &quot;ddddd&quot;, &quot;eee&quot;, &quot;ffff&quot;, &quot;g&quot;, &quot;hh&quot;, &quot;iiiii&quot;, &quot;jjj&quot;);
    }
</code></pre>
<p>ã“ã‚Œã¯ã¡ã‚‡ã£ã¨é›£ã—ã„ã‹ã‚‚ã€‚è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚</p>
<p>ã§ããŸæ–¹ã¯<a href="https://github.com/making/reactor-dojo/pulls">Pull Request</a>ã‚’é€ã£ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
</div>
</article>
<footer>
    <a href="https://blog.ik.am">BLOG.IK.AM</a> â€” &copy; 2010-2017 <a href="https://twitter.com/making">Toshiaki
    Maki</a>
</footer>
</body>
</html>